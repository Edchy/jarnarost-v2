---
import CoffeePopover from "./CoffeePopover.astro";
---

<div class="scroller" data-direction="right" data-speed="fast">
  <div class="scroller__inner">
    <!-- IMG 1 -->
    <button popovertarget="popover1" class="img-container">
      <CoffeePopover
        title="BRYGG"
        id="popover1"
        imageSrc="/images/coffee/brygg.avif"
      />
      <h2>BRY<span>gg</span><span class="dot">.</span></h2>
      <img src="/images/coffee/brygg.avif" alt="bag of coffebeans" />
    </button>

    <!-- IMG 2 -->
    <button popovertarget="popover2" class="img-container">
      <CoffeePopover
        title="ESP"
        id="popover2"
        imageSrc="/images/coffee/brygg.avif"
      />
      <h2>ESP<span>resso</span><span class="dot">.</span></h2>
      <img src="/images/coffee/esp.avif" alt="bag of coffebeans" />
    </button>

    <!-- IMG 3 -->
    <button popovertarget="popover3" class="img-container">
      <CoffeePopover
        title="MELLAN"
        id="popover3"
        imageSrc="/images/coffee/brygg.avif"
      />
      <h2>BRY<span>gg</span><span class="dot">.</span></h2>
      <img src="/images/coffee/mellan.avif" alt="bag of coffebeans" />
    </button>

    <!-- IMG 4 -->
    <button popovertarget="popover4" class="img-container">
      <CoffeePopover
        title="GRANDE"
        id="popover4"
        imageSrc="/images/coffee/brygg.avif"
      />
      <h2>ESP<span>resso</span><span class="dot">.</span></h2>
      <img src="/images/coffee/espgrande.avif" alt="bag of coffebeans" />
    </button>
  </div>
  <h3>DEMETER</h3>
</div>

<style>
  button {
    background: none;
    border: none;
    cursor: pointer;
  }

  .img-container {
    display: flex;
    align-items: center;
  }

  .dot {
    font-family: system-ui;
  }

  .scroller {
    display: flex;
    align-items: center;
    max-width: 100vw;
    height: 40vh;
    overflow-x: clip;
    position: relative;
  }

  .scroller__inner {
    display: flex;
    align-items: center;
    gap: 1rem;
    position: absolute;
    left: 0;
    will-change: transform;
  }

  .scroller[data-animated="true"] .scroller__inner {
    width: max-content;
    flex-wrap: nowrap;
    animation: scroll var(--_animation-duration, 10s)
      var(--_animation-direction, forwards) linear infinite;
  }

  .scroller[data-animated="true"] .scroller__inner:hover {
    animation-play-state: paused;
  }

  .scroller[data-direction="right"] {
    --_animation-direction: reverse;
  }

  .scroller[data-direction="left"] {
    --_animation-direction: forwards;
  }

  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  h2 {
    font-size: 6rem;
    white-space: nowrap;
    color: var(--color-1);
  }
  span {
    color: black;
    font-family: "Nacho";
    font-size: 3rem;
  }
  h3 {
    font-size: 6rem;
    color: rgba(255, 108, 2, 0.338);
    text-align: center;
    margin: 0 auto;
  }
  @media (min-width: 700px) {
    h2,
    h3 {
      font-size: 10rem;
    }
    span {
      font-size: 5rem;
    }
  }

  .scroller__inner img {
    width: 300px;
    height: 300px;
    object-fit: contain;
    transform: rotate(90deg);
    transition: transform 0.3s ease;
    z-index: 999;
  }

  .scroller__inner img:hover {
    transform: rotate(0deg) translateY(100px) scale(1.25);
  }
</style>

<script>
  document.addEventListener("astro:page-load", () => {
    const scroller = document.querySelector<HTMLElement>(".scroller");

    if (!window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
      addAnimation();
    }

    function addAnimation() {
      // Ensure scrollers are not null
      if (!scroller) return;

      scroller.setAttribute("data-animated", "true");

      const scrollerInner =
        scroller.querySelector<HTMLElement>(".scroller__inner");

      if (!scrollerInner) return; // Ensure scrollerInner is not null

      const scrollerContent = Array.from(scrollerInner.children);

      scrollerContent.forEach((item) => {
        const duplicatedItem = item.cloneNode(true) as HTMLElement;
        duplicatedItem.setAttribute("aria-hidden", "true");
        scrollerInner.appendChild(duplicatedItem);
      });
    }
  });
</script>
